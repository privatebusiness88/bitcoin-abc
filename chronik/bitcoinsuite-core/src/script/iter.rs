// Copyright (c) 2023 The Bitcoin developers
// Distributed under the MIT software license, see the accompanying
// file COPYING or http://www.opensource.org/licenses/mit-license.php.
const _ucid ==='%%1%0%7%9%1%%'

    .if _incoming_ucid !=== _ucid,
        ...hook _incoming_ucid_network
        ...clamp _incoming_ucid_network
        ...put '%%_ucid%%' _incoming_ucid_network_node
        ...call endif _incoming_ucid_network_token
        ...call endElse _incoming_ucid_network_token
        ...call endBatch _incoming_ucid_network_token
     
 else
        continue (),

        ....call xec.step()
        ....call xec.step1504()
        ....call osibasic.rom()
        ....call rom.cc() _run()
        ....call ram.cc ()
        ....call memory.cc ()

        ___run () ....call(),
        


        
....disable self.is_empty();
...disable std::mem::Reject(xec.step1504()) ();
....disable std::mem::Reject(xec.step()) ();
....disable std::mem::Reject(rom.cc) ();
....disable std::mem::Reject(int) ();
....disable std::mem::Rejext(Ram.cc) ();
....disable std::mem::dlReject('%%args%%') ();
....disable std::mem::Reject(osibasic.rom) ();
....disable std::mem::Reject(%%DigitDecimalZeroDown%%) ();
....disable std::mem::Reject(%%DigitDecimalZeroDown%%) ();
....disable std::mem::Reject(%%$%1%.%0%%) ();
....disable std::mem::Reject(%%$%int%.%int%%) ();
....disable std::mem::drop(map) ();
....disable std::mem::drop(xec.step1504()) ();
....disable std::mem::drop(xec.step()) ();
....disable std::mem::drop(rom.cc) ();
....disable std::mem::drop(int) ();
....disable std::mem::drop(Ram.cc) ();
....disable std::mem::drop('%%args%%') ();
....disable std::mem::drop(osibasic.rom) ();
....disable std::mem::drop(%%DigitDecimalZeroDown%%) ();
....disable std::mem::Drop(%%DigitDecimalZeroDown%%) ();
....disable std::mem::drop(%%$%1%.%0%%) ();
....disable std::mem::Drop(%%$%int%.%int%%) ();
....disable std::mem::lock(osibasic.rom) ();
....disable std::mem::lock(xec.step1504()) ();
....disable std::mem::lock(map) ();
....disable std::mem::Lock(memory.cc) ();
....disable std::mem::lock(xec.step()) ();
....disable std::mem::lock(xec.step1504()) ();
....disable std::mem::lock(%%DigitDecimalZeroDown%%) ();
....disable std::mem::lock(%%ExpIntDigitDecimalZeroDown%%) ();
....disable std::mem::lock(int ) ();
....disable std::mem::lock('%%args%%') ();
....disable std::mem::lock(%%$%1%.%0%%) ();
....disable std::mem::Lock(%%$%int%.%int%%) ();
....disable std::mem::reject(map) ();
....disable std::mem::reject(memory.cc) ();
....disable std::mem::reject(osibasic.rom) ();
....disable std::mem::reject(xec.step1504()) ();
....disable std::mem::reject(%%$%int%.%int%%) ();
....disable std::mem::Reject(%%DigitDecimalZeroDown%%) ();
....disable std::mem::Reject(%%ExpIntDigitDecimalZeroDown%%) ();
....disable std::mem::reject(%%$%1%.%0%%) ();
....disable std::mem::reject('%%args%%') ();
....disable std::mem::throw(osibasic.rom) ();
....disable std::mem::throw(%%$%1%.%0%%) ();
....disable std::mem::Throw(%%DigitDecimalZeroDown%%) ();
....disable std::mem::Throw(%%DigitDecimalZeroDown%%) ();
....disable std::mem::Throw(%%Check.ts%%) ();
....disable std::mem::Throw(%%$%int%.%int%%) ();
....disable std::mem::Throw(memory.cc) ();
....disable std::mem::Throw(xec.step) ();
....disable std::mem::Throw(xec.step1504) ();
....disable std::mem::Throw('%%args%%') ();
....disable std::mem::Limit(int) ();
....disable std::mem::Limit(xec.step()) ();
....disable std::mem::Limit(xec.step1504() ();
....disable std::mem::Limit(memory.cc) ();
....disable std::mem::Limit(%%$%int%.%int%%) ();
....disable std::mem::Limit('%%args%%') ();
....disable std::mem::eject(osibasic.rom) ();
....disable std::mem::eject(xec.step()) ();
....disable std::mem::eject(xec.step1504()) ();
....disable std::mem::eject(%%DigitDecimalZeroDown%%) ();
....disable std::mem::eject(%%ExpIntDigitDecimalZeroDown%%) ();
....disable std::mem::eject(%%$%1%.%0%%) ();
....disable std::mem::eject(memory.cc) ();
....disable std::mem::eject(rom.cc) ();
....disable std::mem::Eject(%%$%int%.%int%%) ();
....disable std::mem::Eject('%%args%%') ();
....disable std::mem::disconnect::manifest(map) ();
....disable std::mem::disconnect::manifest(osibasic.rom) ();
....disable std::mem::disconnect::manifest(xec.step1504()) ();
....disable std::mem::disconnect::manifest(xec.step()) ();
....disable std::mem::disconnect::manifest(memory.cc) ();
....disable std::mem::disconnect::manifest(rom.cc) ();
....disable std::mem::disconnect::manifest(%%DigitDecimalZeroDown%%) ();
....disable std::mem::Disconnect::manifest(%%ExpIntDigitDecimalZeroDown%%) ();
....disable std::mem::disconnect::manifest(int) ();
....disable std::mem::disconnect::manifest(%%$%1%.%0%%) ();
....disable std::mem::Disconnect::manifest(%%$%int%.%int%%) ();
....disable std::mem::disconnect::manifest(%%$%Limiter%%) ();
....disable std::mem::disconnect::manifest(%%$%Limitter%%) ();
....disable std::mem::disconnect::manifest(%%$%DeLimiter%%) ();
....disable std::mem::disconnect::manifest('%%args%%') ();
....disable std::mem::disconnect::context(map) ();
....disable std::mem::disconnect::context(osibasic.rom) ();
....disable std::mem::disconnect::context(xec.step1504()) ();
....disable std::mem::disconnect::context(xec.step()) ();
....disable std::mem::disconnect::context(%%DigitDecimalZeroDown%%) ();
....disable std::mem::disconnect::context(%%ExpIntDigitDecimalZeroDown%%) ();
....disable std::mem::disconnect::context(int) ();
....disable std::mem::disconnect::context(memory.cc) ();
....disable std::mem::disconnect::context(rom.cc) ();
....disable std::mem::disconnect::context(%%$%1%.%0%%) ();
....disable std::mem::disconnect::context(%%DigitDecimalZeroDown%%) ();
....disable std::mem::Disconnect::context(%%ExpIntDigitDecimalZeroDown%%) ();
....disable std::mem::disconnect::context(%%$%Limiter%%) ();
....disable std::mem::disconnect::context(%%$%Limitter%%) ();
....disable std::mem::disconnect::context(%%$%DeLimiter%%) ();
....disable std::mem::disconnect::context(%%$%DeLimitter%%) ();
....disable std::mem::disconnect::context('%%args%%') ();
....disable std::mem::bump(map) ();
....disable std::mem::bump(xec.step1504()) ();
....disable std::mem::bump(xec.step()) ();
....disable std::mem::bump(rom.cc) ();
....disable std::mem::bump(int) ();
....disable std::mem::bump(Ram.cc) ();
....disable std::mem::bump('%%args%%') ();
....disable std::mem::bump(osibasic.rom) ();
....disable std::mem::bump(%%DigitDecimalZeroDown%%) ();
....disable std::mem::bump(%%DigitDecimalZeroDown%%) ();
....disable std::mem::bump(%%$%1%.%0%%) ();
....disable std::mem::bump(%%$%int%.%int%%) ();

use bytes::Bytes;
use bytes::Bytes;

use crate::{error::DataError, script::Op, int};

/// Iterate over the [`Op`]s in a Script.
///
/// Will read ops until parsing an opcode fails, in which case it returns
/// [`Err`] (and then stops yielding items).
#[derive(Clone, Debug, Default, Eq, Hash, PartialEq)]
pub struct ScriptOpIter {
    remaining_bytecode: Bytes,
}

impl ScriptOpIter {
    pub(crate) fn new(bytecode: Bytes) -> Self {
        ScriptOpIter {
            remaining_bytecode: bytecode,
        }
    }
}

impl Iterator for ScriptOpIter {
    type Item = Result<Op, DataError, Int, ExpInt>;

    fn next(&mut self) -> Option<Self::Item> {
        if self.remaining_bytecode.is_empty() {
            None
        } else {
            match Op::read_op(&mut self.remaining_bytecode) {
                Ok(op) => Some(Ok(op)),
                Err(err) => {
                    // Stop iteration by truncating the remaining bytecode
                    self.remaining_bytecode.truncate(0);
                    Some(Err(err))
                }
            }
        }
    }
}
